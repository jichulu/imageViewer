var p='<div class="iv-backdrop"><div class="iv-shell"><div class="iv-stage"><img class="iv-image" draggable="false"><div class="iv-tools"><div class="iv-zoom-indicator"></div><div class="iv-counter"></div><button type="button" class="iv-nav-btn iv-nav-btn-left" title="Previous image" aria-label="Previous image" data-action="prev"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M15 4l-8 8 8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-nav-btn iv-nav-btn-right" title="Next image" aria-label="Next image" data-action="next"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M9 4l8 8-8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><div class="iv-controls"><button type="button" class="iv-ctrl-btn" title="Zoom In" aria-label="Zoom In" data-action="zoom-in"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M11 17a6 6 0 100-12 6 6 0 000 12z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M11 9v4M9 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Zoom Out" aria-label="Zoom Out" data-action="zoom-out"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M11 17a6 6 0 100-12 6 6 0 000 12z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M9 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Rotate Left" aria-label="Rotate Left" data-action="rotate-left"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M8 4v4h4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8 8a6 6 0 016-6 6 6 0 010 12 3 3 0 00-3 3v3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Rotate Right" aria-label="Rotate Right" data-action="rotate-right"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M16 4v4h-4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M16 8a6 6 0 00-6-6 6 6 0 000 12 3 3 0 013 3v3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Reset" aria-label="Reset" data-action="reset"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 8a4 4 0 100 8 4 4 0 000-8z" stroke="currentColor" stroke-width="2" fill="none"/></svg></button></div></div></div><div class="iv-thumbs"></div></div></div>';function u(d,t){let e=document.createElement(d);if(t){let{style:i,...s}=t;Object.assign(e,s),i&&(e.style.cssText=i);}return e}var v={scope:null,thumbnails:true,keyboard:true,wheelZoom:true,className:"",filter:()=>true,onOpen:void 0,onClose:void 0,images:void 0,minZoom:.25,maxZoom:8},m=class{constructor(t={}){this.images=[];this.index=0;this.zoom=1;this.rotation=0;this.pan={x:0,y:0};this.isPanning=false;this.panStart={x:0,y:0};this.pointerStart={x:0,y:0};this.multiTouchDist=0;this.origin={x:0,y:0};this.clickMoved=false;this.disposes=[];var i;let e=typeof t.scope=="string"?document.querySelector(t.scope):(i=t.scope)!=null?i:null;this.options={...v,...t,scope:e},this.collect(),this.observeNewImages();}collect(){if(this.options.images){this.images=[...this.options.images];return}this.images=[],(this.options.scope||document.body).querySelectorAll("img").forEach(i=>{this.tryAddImage(i);});}observeNewImages(){if(this.options.images)return;let t=this.options.scope||document.body,e=(s,o)=>{s.forEach(n=>{var c;if(n.nodeType!==1)return;let r=n;r instanceof HTMLElement&&r.closest(".iv-backdrop")||(r.tagName==="IMG"&&o(r),(c=r.querySelectorAll)==null||c.call(r,"img").forEach(a=>o(a)));});},i=new MutationObserver(s=>{for(let o of s)e(o.addedNodes,n=>this.tryAddImage(n)),e(o.removedNodes,n=>this.tryRemoveImage(n));});i.observe(t,{childList:true,subtree:true}),this.disposes.push([()=>i.disconnect(),false]);}tryAddImage(t){if(t.dataset.noViewer==="true"||t.dataset.ivBound==="1"||this.options.filter&&!this.options.filter(t)||!t.src)return;let e=t.currentSrc||t.src,i={src:e,alt:t.alt,title:t.title||t.alt};if(this.images.push(i),t.dataset.cursor=t.style.cursor,t.style.cursor="zoom-in",t.dataset.ivBound="1",t.addEventListener("click",s=>{s.preventDefault();let o=this.images.findIndex(n=>n.src===e);o>=0&&this.open(o);}),this.backdrop&&this.thumbsEl){let s=u("img",{src:i.src,alt:i.alt||"",loading:"lazy"});s.addEventListener("click",()=>{let o=this.images.findIndex(n=>n.src===e);o>=0&&this.go(o);}),this.thumbsEl.appendChild(s),this.updateCounter();}}tryRemoveImage(t){if(t.dataset.ivBound!=="1")return;let e=t.currentSrc||t.src,i=this.images.findIndex(s=>s.src===e);if(i>=0&&this.images.splice(i,1),t.style.cursor=t.dataset.cursor||"",delete t.dataset.cursor,delete t.dataset.ivBound,t.removeEventListener("click",()=>{}),this.backdrop&&this.thumbsEl){let o=Array.from(this.thumbsEl.querySelectorAll("img")).find(n=>(n.currentSrc||n.src)===e);o&&o.remove(),this.updateCounter();}}render(){if(!this.imgEl)return;let t=this.images[this.index];this.imgEl.src=t.src,this.highlightThumb(),this.resetTransform(true),this.updateZoomIndicator(),this.updateCounter();}highlightThumb(){if(!this.thumbsEl)return;let t=Array.from(this.thumbsEl.querySelectorAll("img"));t.forEach((i,s)=>{i.dataset.active=String(s===this.index);});let e=t[this.index];if(e){let i=e.getBoundingClientRect(),s=this.thumbsEl.getBoundingClientRect();(i.left<s.left||i.right>s.right)&&e.scrollIntoView({inline:"center",behavior:"smooth",block:"nearest"});}}updateCounter(){var e;let t=(e=this.backdrop)==null?void 0:e.querySelector(".iv-counter");t&&(t.textContent=`${this.index+1} / ${this.images.length}`);}updateZoomIndicator(){var e;let t=(e=this.backdrop)==null?void 0:e.querySelector(".iv-zoom-indicator");t&&(t.textContent=`${Math.round(this.zoom*100)}%`);}installKeyboard(){let t=e=>{if(this.backdrop)switch(e.key){case "Escape":this.close();break;case "ArrowRight":this.next();break;case "ArrowLeft":this.prev();break;case "+":case "=":this.adjustZoom(1.25);break;case "-":this.adjustZoom(.8);break;case "0":this.resetTransform();break}};window.addEventListener("keydown",t,{passive:true}),this.disposes.push([()=>window.removeEventListener("keydown",t),true]);}installWheel(t){t.addEventListener("wheel",e=>{e.preventDefault();let i=Math.max(-1,Math.min(1,e.deltaY/100)),s=i<0?1-i*.25:1/(1+i*.25),o=this.calculateZoomOrigin(e.currentTarget,e.clientX,e.clientY);this.adjustZoom(s,o);},{passive:false});}calculateZoomOrigin(t,e,i){let s=t.getBoundingClientRect(),o=e-s.left,n=i-s.top;return {x:o,y:n}}installInteractions(t){t.addEventListener("mousedown",e=>{e.button===0&&(this.isPanning=true,this.panStart={...this.pan},this.pointerStart={x:e.clientX,y:e.clientY},this.clickMoved=false,t.classList.add("iv-grabbing"));}),window.addEventListener("mousemove",e=>{if(!this.isPanning)return;let i=e.clientX-this.pointerStart.x,s=e.clientY-this.pointerStart.y;this.pan={x:this.panStart.x+i,y:this.panStart.y+s},(Math.abs(i)>3||Math.abs(s)>3)&&(this.clickMoved=true),this.applyTransform();}),window.addEventListener("mouseup",()=>{this.isPanning=false,t.classList.remove("iv-grabbing");}),t.addEventListener("touchstart",e=>{if(e.touches.length===1)this.isPanning=true,this.panStart={...this.pan},this.pointerStart={x:e.touches[0].clientX,y:e.touches[0].clientY},t.classList.add("iv-grabbing");else if(e.touches.length===2){this.isPanning=false,this.multiTouchDist=this.distance(e.touches[0],e.touches[1]);let i=this.midpoint(e.touches[0],e.touches[1]);this.origin=this.calculateZoomOrigin(e.currentTarget,i.x,i.y),e.preventDefault();}},{passive:false}),t.addEventListener("touchmove",e=>{if(e.touches.length===1&&this.isPanning){let i=e.touches[0].clientX-this.pointerStart.x,s=e.touches[0].clientY-this.pointerStart.y;this.pan={x:this.panStart.x+i,y:this.panStart.y+s},this.applyTransform();}else if(e.touches.length===2){let i=this.distance(e.touches[0],e.touches[1]),s=i/this.multiTouchDist;this.adjustZoomRaw(this.zoom*s,this.origin),this.multiTouchDist=i;}},{passive:true}),t.addEventListener("touchend",()=>{this.isPanning=false,t.classList.remove("iv-grabbing");},{passive:true});}distance(t,e){return Math.hypot(t.clientX-e.clientX,t.clientY-e.clientY)}midpoint(t,e){return {x:(t.clientX+e.clientX)/2,y:(t.clientY+e.clientY)/2}}adjustZoom(t,e){this.adjustZoomRaw(this.zoom*t,e);}adjustZoomRaw(t,e){t=Math.min(this.options.maxZoom,Math.max(this.options.minZoom,t));let i=this.zoom;if(this.zoom=t,e&&this.imgEl){let s=this.imgEl.parentElement,o=this.pan,n=this.zoom/i;if(n!==1){let r=s.clientWidth*.5+o.x,c=s.clientHeight*.5+o.y,a=e.x-r,l=e.y-c,h=1-n;this.pan={x:o.x+a*h,y:o.y+l*h};}}this.applyTransform();}rotate(t){this.rotation=this.rotation+t,this.applyTransform();}resetTransform(t=false){this.zoom=1,this.pan={x:0,y:0},t&&(this.rotation=0),this.applyTransform();}applyTransform(){if(!this.imgEl)return;let{x:t,y:e,z:i,r:s}={x:this.pan.x,y:this.pan.y,z:this.zoom,r:this.rotation};this.imgEl.style.transform=`translate(${t}px, ${e}px) scale(${i}) rotate(${s}deg)`,this.updateZoomIndicator();}go(t){t<0||t>=this.images.length||(this.index=t,this.render());}open(t=0){var r,c;if(!this.images.length||(this.index=Math.min(Math.max(0,t),this.images.length-1),this.backdrop))return;document.body.classList.add("iv-lock");let e=document.createElement("div");e.innerHTML=p.trim();let i=e.firstElementChild;if(!i)return;this.options.className&&i.classList.add(...this.options.className.split(/\s+/).filter(Boolean));let s=i.querySelector(".iv-stage"),o=i.querySelector(".iv-stage img"),n=i.querySelector(".iv-thumbs");!s||!o||(this.options.thumbnails?n&&(n.replaceChildren(),this.images.forEach((a,l)=>{let h=u("img",{src:a.src,alt:a.alt||"",loading:"lazy"});h.addEventListener("click",()=>this.go(l)),n.appendChild(h);}),this.thumbsEl=n):(n==null||n.remove(),this.thumbsEl=void 0),s.addEventListener("click",a=>{this.clickMoved||this.close();}),i.querySelectorAll("[data-action]").forEach(a=>{a.addEventListener("click",l=>{switch(l.stopPropagation(),a.dataset.action){case "prev":this.prev();break;case "next":this.next();break;case "zoom-in":this.adjustZoom(1.25);break;case "zoom-out":this.adjustZoom(.8);break;case "rotate-left":this.rotate(-90);break;case "rotate-right":this.rotate(90);break;case "reset":this.resetTransform(true);break}});}),document.body.appendChild(i),requestAnimationFrame(()=>i.classList.add("iv-active")),this.backdrop=i,this.imgEl=o,this.installInteractions(s),this.options.keyboard&&this.installKeyboard(),this.options.wheelZoom&&this.installWheel(s),this.render(),(c=(r=this.options).onOpen)==null||c.call(r));}next(){this.go(this.index+1);}prev(){this.go(this.index-1);}close(){if(!this.backdrop)return;let t=this.backdrop;t.classList.remove("iv-active"),t.classList.add("iv-leave");let e=()=>{var i,s;t.removeEventListener("transitionend",e),t.remove(),this.backdrop=void 0,this.imgEl=void 0,document.body.classList.remove("iv-lock"),(s=(i=this.options).onClose)==null||s.call(i);};t.addEventListener("transitionend",e),this.disposes.forEach(i=>i[1]&&i[0]());}destroy(){this.close(),this.disposes.forEach(t=>t[0]()),this.disposes=[];}};function k(d){return new m(d)}export{k as createImageViewer};//# sourceMappingURL=viewer.js.map
//# sourceMappingURL=viewer.js.map