var ImageViewer=(function(exports){'use strict';var p='<div class="iv-backdrop"><div class="iv-shell"><div class="iv-stage"><img class="iv-image" draggable="false"><div class="iv-tools"><div class="iv-zoom-indicator"></div><div class="iv-counter"></div><button type="button" class="iv-nav-btn iv-nav-btn-left" title="Previous image" aria-label="Previous image" data-action="prev"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M15 4l-8 8 8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-nav-btn iv-nav-btn-right" title="Next image" aria-label="Next image" data-action="next"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M9 4l8 8-8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><div class="iv-controls"><button type="button" class="iv-ctrl-btn" title="Zoom In" aria-label="Zoom In" data-action="zoom-in"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M11 17a6 6 0 100-12 6 6 0 000 12z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M11 9v4M9 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Zoom Out" aria-label="Zoom Out" data-action="zoom-out"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M11 17a6 6 0 100-12 6 6 0 000 12z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M9 11h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M16.5 16.5L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Rotate Left" aria-label="Rotate Left" data-action="rotate-left"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M8 4v4h4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8 8a6 6 0 016-6 6 6 0 010 12 3 3 0 00-3 3v3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Rotate Right" aria-label="Rotate Right" data-action="rotate-right"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M16 4v4h-4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M16 8a6 6 0 00-6-6 6 6 0 000 12 3 3 0 013 3v3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></button> <button type="button" class="iv-ctrl-btn" title="Reset" aria-label="Reset" data-action="reset"><svg viewBox="0 0 24 24" class="iv-icon" aria-hidden="true"><path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 8a4 4 0 100 8 4 4 0 000-8z" stroke="currentColor" stroke-width="2" fill="none"/></svg></button></div></div></div><div class="iv-thumbs"></div></div></div>';function h(g,t){let i=document.createElement(g);if(t){let{style:e,...o}=t;Object.assign(i,o),e&&(i.style.cssText=e);}return i}var b={scope:null,thumbnails:true,closeOnBackdrop:true,keyboard:true,wheelZoom:true,className:"",filter:()=>true,onOpen:void 0,onClose:void 0,images:void 0,minZoom:.25,maxZoom:8},u=class{constructor(t={}){this.images=[];this.index=0;this.zoom=1;this.rotation=0;this.pan={x:0,y:0};this.isPanning=false;this.panStart={x:0,y:0};this.pointerStart={x:0,y:0};this.multiTouchDist=0;this.origin={x:0,y:0};this.clickMoved=false;this.disposes=[];var e;let i=typeof t.scope=="string"?document.querySelector(t.scope):(e=t.scope)!=null?e:null;this.options={...b,...t,scope:i},this.collect(),this.observeNewImages();}collect(){if(this.options.images){this.images=[...this.options.images];return}this.images=[],(this.options.scope||document.body).querySelectorAll("img").forEach(e=>{this.tryAddImage(e);});}observeNewImages(){if(this.options.images)return;let t=this.options.scope||document.body,i=(o,s)=>{o.forEach(c=>{var r;if(c.nodeType!==1)return;let a=c;a.tagName==="IMG"&&s(a),(r=a.querySelectorAll)==null||r.call(a,"img").forEach(n=>s(n));});},e=new MutationObserver(o=>{for(let s of o)i(s.addedNodes,c=>this.tryAddImage(c)),i(s.removedNodes,c=>this.tryRemoveImage(c));});e.observe(t,{childList:true,subtree:true}),this.disposes.push([()=>e.disconnect(),false]);}tryAddImage(t){if(t.dataset.noViewer==="true"||t.dataset.ivBound==="1"){console.log("skip",t);return}if(this.options.filter&&!this.options.filter(t)){console.log("filtered",t);return}if(!t.src){console.log("no src",t);return}let i=t.currentSrc||t.src,e={src:i,alt:t.alt,title:t.title||t.alt};if(this.images.push(e),t.style.cursor="zoom-in",t.dataset.ivBound="1",t.addEventListener("click",o=>{o.preventDefault();let s=this.images.findIndex(c=>c.src===i);s>=0&&this.open(s);}),this.backdrop&&this.thumbsEl){let o=h("img",{src:e.src,alt:e.alt||"",loading:"lazy"});o.addEventListener("click",()=>{let s=this.images.findIndex(c=>c.src===i);s>=0&&this.go(s);}),this.thumbsEl.appendChild(o),this.updateCounter();}}tryRemoveImage(t){if(t.dataset.ivBound!=="1")return;let i=t.currentSrc||t.src,e=this.images.findIndex(o=>o.src===i);if(e>=0&&this.images.splice(e,1),delete t.dataset.ivBound,t.style.cursor="",t.removeEventListener("click",()=>{}),this.backdrop&&this.thumbsEl){let s=Array.from(this.thumbsEl.querySelectorAll("img")).find(c=>(c.currentSrc||c.src)===i);s&&s.remove(),this.updateCounter();}}render(){if(!this.imgEl)return;let t=this.images[this.index];this.imgEl.src=t.src,this.highlightThumb(),this.resetTransform(true),this.updateZoomIndicator(),this.updateCounter();}highlightThumb(){if(!this.thumbsEl)return;let t=Array.from(this.thumbsEl.querySelectorAll("img"));t.forEach((e,o)=>{e.dataset.active=String(o===this.index);});let i=t[this.index];if(i){let e=i.getBoundingClientRect(),o=this.thumbsEl.getBoundingClientRect();(e.left<o.left||e.right>o.right)&&i.scrollIntoView({inline:"center",behavior:"smooth",block:"nearest"});}}updateCounter(){var i;let t=(i=this.backdrop)==null?void 0:i.querySelector(".iv-counter");t&&(t.textContent=`${this.index+1} / ${this.images.length}`);}updateZoomIndicator(){var i;let t=(i=this.backdrop)==null?void 0:i.querySelector(".iv-zoom-indicator");t&&(t.textContent=`${Math.round(this.zoom*100)}%`);}installKeyboard(){let t=i=>{if(this.backdrop)switch(i.key){case "Escape":this.close();break;case "ArrowRight":this.next();break;case "ArrowLeft":this.prev();break;case "+":case "=":this.adjustZoom(1.25);break;case "-":this.adjustZoom(.8);break;case "0":this.resetTransform();break}};window.addEventListener("keydown",t,{passive:true}),this.disposes.push([()=>window.removeEventListener("keydown",t),true]);}installWheel(t){t.addEventListener("wheel",i=>{i.preventDefault();let e=Math.max(-1,Math.min(1,i.deltaY/100)),o=e<0?1-e*.25:1/(1+e*.25),s=this.calculateZoomOrigin(i.clientX,i.clientY);this.adjustZoom(o,s);},{passive:false});}calculateZoomOrigin(t,i){let e=this.imgEl.parentElement,o=e.getBoundingClientRect(),s=window.getComputedStyle(e),c={left:parseFloat(s.paddingLeft),top:parseFloat(s.paddingTop)},a=t-o.left-c.left,r=i-o.top-c.top;return {x:a,y:r}}installInteractions(t){t.addEventListener("mousedown",i=>{i.button===0&&(this.isPanning=true,this.panStart={...this.pan},this.pointerStart={x:i.clientX,y:i.clientY},this.clickMoved=false,t.classList.add("iv-grabbing"));}),window.addEventListener("mousemove",i=>{if(!this.isPanning)return;let e=i.clientX-this.pointerStart.x,o=i.clientY-this.pointerStart.y;this.pan={x:this.panStart.x+e,y:this.panStart.y+o},(Math.abs(e)>3||Math.abs(o)>3)&&(this.clickMoved=true),this.applyTransform();}),window.addEventListener("mouseup",()=>{this.isPanning=false,t.classList.remove("iv-grabbing");}),t.addEventListener("touchstart",i=>{if(i.touches.length===1)this.isPanning=true,this.panStart={...this.pan},this.pointerStart={x:i.touches[0].clientX,y:i.touches[0].clientY},t.classList.add("iv-grabbing");else if(i.touches.length===2){this.isPanning=false,this.multiTouchDist=this.distance(i.touches[0],i.touches[1]);let e=this.midpoint(i.touches[0],i.touches[1]);this.origin=this.calculateZoomOrigin(e.x,e.y),i.preventDefault();}},{passive:false}),t.addEventListener("touchmove",i=>{if(i.touches.length===1&&this.isPanning){let e=i.touches[0].clientX-this.pointerStart.x,o=i.touches[0].clientY-this.pointerStart.y;this.pan={x:this.panStart.x+e,y:this.panStart.y+o},this.applyTransform();}else if(i.touches.length===2){let e=this.distance(i.touches[0],i.touches[1]),o=e/this.multiTouchDist;this.adjustZoomRaw(this.zoom*o,this.origin),this.multiTouchDist=e;}},{passive:true}),t.addEventListener("touchend",()=>{this.isPanning=false,t.classList.remove("iv-grabbing");},{passive:true});}distance(t,i){return Math.hypot(t.clientX-i.clientX,t.clientY-i.clientY)}midpoint(t,i){return {x:(t.clientX+i.clientX)/2,y:(t.clientY+i.clientY)/2}}adjustZoom(t,i){this.adjustZoomRaw(this.zoom*t,i);}adjustZoomRaw(t,i){t=Math.min(this.options.maxZoom,Math.max(this.options.minZoom,t));let e=this.zoom;if(this.zoom=t,i&&this.imgEl){let o=this.imgEl.parentElement,s=this.pan,c=this.zoom/e;if(c!==1){let a=o.clientWidth*.5+s.x,r=o.clientHeight*.5+s.y,n=i.x-a,l=i.y-r,d=1-c;this.pan={x:s.x+n*d,y:s.y+l*d};}}this.applyTransform();}rotate(t){this.rotation=this.rotation+t,this.applyTransform();}resetTransform(t=false){this.zoom=1,this.pan={x:0,y:0},t&&(this.rotation=0),this.applyTransform();}applyTransform(){if(!this.imgEl)return;let{x:t,y:i,z:e,r:o}={x:this.pan.x,y:this.pan.y,z:this.zoom,r:this.rotation};this.imgEl.style.transform=`translate(${t}px, ${i}px) scale(${e}) rotate(${o}deg)`,this.updateZoomIndicator();}go(t){t<0||t>=this.images.length||(this.index=t,this.render());}open(t=0){var a,r;if(!this.images.length||(this.index=Math.min(Math.max(0,t),this.images.length-1),this.backdrop))return;document.body.classList.add("iv-lock");let i=document.createElement("div");i.innerHTML=p.trim();let e=i.firstElementChild;if(!e)return;this.options.className&&e.classList.add(...this.options.className.split(/\s+/).filter(Boolean));let o=e.querySelector(".iv-stage"),s=e.querySelector(".iv-stage img"),c=e.querySelector(".iv-thumbs");!o||!s||(this.options.thumbnails?c&&(c.replaceChildren(),this.images.forEach((n,l)=>{let d=h("img",{src:n.src,alt:n.alt||"",loading:"lazy"});d.addEventListener("click",()=>this.go(l)),c.appendChild(d);}),this.thumbsEl=c):(c==null||c.remove(),this.thumbsEl=void 0),this.options.closeOnBackdrop&&e.addEventListener("mousedown",n=>{n.target===e&&this.close();}),o.addEventListener("click",n=>{this.clickMoved||this.close();}),e.querySelectorAll("[data-action]").forEach(n=>{n.addEventListener("click",l=>{switch(l.stopPropagation(),n.dataset.action){case "prev":this.prev();break;case "next":this.next();break;case "zoom-in":this.adjustZoom(1.25);break;case "zoom-out":this.adjustZoom(.8);break;case "rotate-left":this.rotate(-90);break;case "rotate-right":this.rotate(90);break;case "reset":this.resetTransform(true);break}});}),document.body.appendChild(e),requestAnimationFrame(()=>e.classList.add("iv-active")),this.backdrop=e,this.imgEl=s,this.installInteractions(o),this.options.keyboard&&this.installKeyboard(),this.options.wheelZoom&&this.installWheel(o),this.render(),(r=(a=this.options).onOpen)==null||r.call(a));}next(){this.go(this.index+1);}prev(){this.go(this.index-1);}close(){if(!this.backdrop)return;let t=this.backdrop;t.classList.remove("iv-active"),t.classList.add("iv-leave");let i=()=>{var e,o;t.removeEventListener("transitionend",i),t.remove(),this.backdrop=void 0,this.imgEl=void 0,document.body.classList.remove("iv-lock"),(o=(e=this.options).onClose)==null||o.call(e);};t.addEventListener("transitionend",i),this.disposes.forEach(e=>e[1]&&e[0]());}destroy(){this.close(),this.disposes.forEach(t=>t[0]()),this.disposes=[];}};function G(g){return new u(g)}exports.createImageViewer=G;return exports;})({});//# sourceMappingURL=viewer.global.js.map
//# sourceMappingURL=viewer.global.js.map