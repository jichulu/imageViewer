{"version":3,"sources":["../src/backdrop.html","../src/viewer.ts"],"names":["backdrop_default","DEFAULTS","_createEl","ImageViewer","opts","__privateAdd","tag","props","el","style","rest","_a","scope","img","root","processMutation","nodes","fn","node","mo","muts","m","src","item","e","idx","i","t","__privateGet","imgs","active","r","pr","counter","zoomIndicator","handle","stage","step","factor","origin","clientX","clientY","parent","rect","paddings","cx","cy","dx","dy","midpoint","dist","a","b","nextZoom","prev","pan","scale","centerX","centerY","k","delta","resetRotation","x","y","z","startIndex","_b","wrap","backdrop","imgEl","thumbs","it","btn","bd","done","createImageViewer","options"],"mappings":"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","file":"viewer.js","sourcesContent":["export default \"<div class=\\\"iv-backdrop\\\"><div class=\\\"iv-shell\\\"><div class=\\\"iv-stage\\\"><img class=\\\"iv-image\\\" draggable=\\\"false\\\"><div class=\\\"iv-tools\\\"><div class=\\\"iv-zoom-indicator\\\"></div><div class=\\\"iv-counter\\\"></div><button type=\\\"button\\\" class=\\\"iv-nav-btn iv-nav-btn-left\\\" title=\\\"Previous image\\\" aria-label=\\\"Previous image\\\" data-action=\\\"prev\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M15 4l-8 8 8 8\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/></svg></button> <button type=\\\"button\\\" class=\\\"iv-nav-btn iv-nav-btn-right\\\" title=\\\"Next image\\\" aria-label=\\\"Next image\\\" data-action=\\\"next\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M9 4l8 8-8 8\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/></svg></button><div class=\\\"iv-controls\\\"><button type=\\\"button\\\" class=\\\"iv-ctrl-btn\\\" title=\\\"Zoom In\\\" aria-label=\\\"Zoom In\\\" data-action=\\\"zoom-in\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M11 17a6 6 0 100-12 6 6 0 000 12z\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/><path d=\\\"M11 9v4M9 11h4\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/><path d=\\\"M16.5 16.5L21 21\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/></svg></button> <button type=\\\"button\\\" class=\\\"iv-ctrl-btn\\\" title=\\\"Zoom Out\\\" aria-label=\\\"Zoom Out\\\" data-action=\\\"zoom-out\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M11 17a6 6 0 100-12 6 6 0 000 12z\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/><path d=\\\"M9 11h4\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/><path d=\\\"M16.5 16.5L21 21\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\"/></svg></button> <button type=\\\"button\\\" class=\\\"iv-ctrl-btn\\\" title=\\\"Rotate Left\\\" aria-label=\\\"Rotate Left\\\" data-action=\\\"rotate-left\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M8 4v4h4\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/><path d=\\\"M8 8a6 6 0 016-6 6 6 0 010 12 3 3 0 00-3 3v3\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/></svg></button> <button type=\\\"button\\\" class=\\\"iv-ctrl-btn\\\" title=\\\"Rotate Right\\\" aria-label=\\\"Rotate Right\\\" data-action=\\\"rotate-right\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M16 4v4h-4\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/><path d=\\\"M16 8a6 6 0 00-6-6 6 6 0 000 12 3 3 0 013 3v3\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/></svg></button> <button type=\\\"button\\\" class=\\\"iv-ctrl-btn\\\" title=\\\"Reset\\\" aria-label=\\\"Reset\\\" data-action=\\\"reset\\\"><svg viewBox=\\\"0 0 24 24\\\" class=\\\"iv-icon\\\" aria-hidden=\\\"true\\\"><path d=\\\"M12 3v3M12 18v3M3 12h3M18 12h3\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/><path d=\\\"M12 8a4 4 0 100 8 4 4 0 000-8z\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/></svg></button></div></div></div><div class=\\\"iv-thumbs\\\"></div></div></div>\"","\r\nexport interface ImageItem {\r\n    src: string;\r\n    alt?: string;\r\n    title?: string;\r\n}\r\n\r\nexport interface ViewerOptions {\r\n    /** CSS selector or element that bounds the DOM scan */\r\n    scope?: string | HTMLElement;\r\n    /** Show thumbnail strip */\r\n    thumbnails?: boolean;\r\n    /** Close when clicking backdrop */\r\n    closeOnBackdrop?: boolean;\r\n    /** Enable keyboard navigation */\r\n    keyboard?: boolean;\r\n    /** Enable wheel zoom (no Ctrl/⌘ needed) */\r\n    wheelZoom?: boolean;\r\n    /** Extra class names for root element */\r\n    className?: string;\r\n    onOpen?: () => void;\r\n    onClose?: () => void;\r\n    /** Provide images directly; skip DOM scan if set */\r\n    images?: ImageItem[];\r\n    /** Filter function: return true to include an <img> */\r\n    filter?: (img: HTMLImageElement) => boolean;\r\n    minZoom?: number; // default 0.25\r\n    maxZoom?: number; // default 8\r\n}\r\n\r\nconst DEFAULTS: Required<Omit<ViewerOptions, 'onOpen' | 'onClose' | 'images' | 'scope'>> & {\r\n    scope: HTMLElement | null;\r\n    onOpen?: () => void;\r\n    onClose?: () => void;\r\n    images?: ImageItem[];\r\n} = {\r\n    scope: null,\r\n    thumbnails: true,\r\n    closeOnBackdrop: true,\r\n    keyboard: true,\r\n    wheelZoom: true,\r\n    className: '',\r\n    filter: () => true,\r\n    onOpen: undefined,\r\n    onClose: undefined,\r\n    images: undefined,\r\n    minZoom: 0.25,\r\n    maxZoom: 8\r\n};\r\n\r\nimport backdropTemplate from './backdrop.html';\r\n\r\nexport class ImageViewer {\r\n    private options: typeof DEFAULTS;\r\n    private images: ImageItem[] = [];\r\n    private index = 0;\r\n    private backdrop?: HTMLElement;\r\n    private imgEl?: HTMLImageElement;\r\n    private thumbsEl?: HTMLElement;\r\n    private zoom = 1;\r\n    private rotation = 0; // rotation angle (deg)\r\n    private pan = { x: 0, y: 0 };\r\n    private isPanning = false;\r\n    private panStart = { x: 0, y: 0 };\r\n    private pointerStart = { x: 0, y: 0 };\r\n    private multiTouchDist = 0;\r\n    private origin = { x: 0, y: 0 }; // pinch origin\r\n    private clickMoved = false; // track if dragged to suppress click-close\r\n    private disposes: [fn: () => void, close: boolean][] = []; // event unbinders\r\n\r\n    constructor(opts: ViewerOptions = {}) {\r\n        const scope = typeof opts.scope === 'string' ? document.querySelector<HTMLElement>(opts.scope) : opts.scope ?? null;\r\n        this.options = { ...DEFAULTS, ...opts, scope };\r\n        this.collect();\r\n        this.observeNewImages();\r\n    }\r\n\r\n    #createEl = function <K extends keyof HTMLElementTagNameMap>(tag: K, props?: Omit<Partial<HTMLElementTagNameMap[K]>, 'style'> & { style?: string }): HTMLElementTagNameMap[K] {\r\n        const el = document.createElement(tag);\r\n        if (props) {\r\n            const { style, ...rest } = props;\r\n            Object.assign(el, rest);\r\n            if (style) (el as HTMLElement).style.cssText = style;\r\n        }\r\n        return el;\r\n    }\r\n\r\n    // Collect images from DOM\r\n    private collect() {\r\n        if (this.options.images) {\r\n            this.images = [...this.options.images];\r\n            return;\r\n        }\r\n        this.images = [];\r\n        const root = this.options.scope || document.body;\r\n        const nodes = root.querySelectorAll<HTMLImageElement>('img');\r\n        nodes.forEach(img => {\r\n            this.tryAddImage(img);\r\n        });\r\n    }\r\n\r\n    // Observe newly added images\r\n    private observeNewImages() {\r\n        if (this.options.images) return; // skip if images provided directly\r\n        const root = this.options.scope || document.body;\r\n        const processMutation = (nodes: NodeList, fn: (img: HTMLImageElement) => void) => {\r\n            nodes.forEach(node => {\r\n                if (node.nodeType !== 1) return;\r\n                const el = node as Element;\r\n                if (el.tagName === 'IMG') fn(el as HTMLImageElement);\r\n                el.querySelectorAll?.('img').forEach(img => fn(img as HTMLImageElement));\r\n            });\r\n        }\r\n        const mo = new MutationObserver(muts => {\r\n            for (const m of muts) {\r\n                processMutation(m.addedNodes, node => this.tryAddImage(node));\r\n                processMutation(m.removedNodes, node => this.tryRemoveImage(node));\r\n            }\r\n        });\r\n        mo.observe(root, { childList: true, subtree: true });\r\n        this.disposes.push([() => mo.disconnect(), false]);\r\n    }\r\n\r\n    private tryAddImage(img: HTMLImageElement) {\r\n        if (img.dataset.noViewer === 'true' || img.dataset.ivBound === '1') {\r\n            console.log('skip', img);\r\n            return;\r\n        }\r\n        if (this.options.filter && !this.options.filter(img)) {\r\n            console.log('filtered', img);\r\n            return;\r\n        }\r\n        if (!img.src) {\r\n            console.log('no src', img);\r\n            return;\r\n        }\r\n        const src = img.currentSrc || img.src;\r\n        const item: ImageItem = { src, alt: img.alt, title: img.title || img.alt };\r\n        this.images.push(item);\r\n        img.style.cursor = 'zoom-in';\r\n        img.dataset.ivBound = '1';\r\n        img.addEventListener('click', e => {\r\n            e.preventDefault();\r\n            const idx = this.images.findIndex(i => i.src === src);\r\n            if (idx >= 0) this.open(idx);\r\n        });\r\n        if (this.backdrop && this.thumbsEl) {\r\n            const t = this.#createEl('img', { src: item.src, alt: item.alt || '', loading: 'lazy' });\r\n            t.addEventListener('click', () => {\r\n                const idx = this.images.findIndex(i => i.src === src);\r\n                if (idx >= 0) this.go(idx);\r\n            });\r\n            this.thumbsEl.appendChild(t);\r\n            this.updateCounter();\r\n        }\r\n    }\r\n\r\n    private tryRemoveImage(img: HTMLImageElement) {\r\n        if (img.dataset.ivBound !== '1') return;\r\n        const src = img.currentSrc || img.src;\r\n        const idx = this.images.findIndex(i => i.src === src);\r\n        if (idx >= 0) this.images.splice(idx, 1);\r\n        delete img.dataset.ivBound;\r\n        img.style.cursor = '';\r\n        img.removeEventListener('click', () => { });\r\n        if (this.backdrop && this.thumbsEl) {\r\n            const thumbs = Array.from(this.thumbsEl.querySelectorAll('img'));\r\n            const t = thumbs.find(t => (t.currentSrc || t.src) === src);\r\n            if (t) t.remove();\r\n            this.updateCounter();\r\n        }\r\n    }\r\n\r\n    // SVG icons & buttons now provided via static HTML template (backdrop.html)\r\n\r\n    private render() {\r\n        if (!this.imgEl) return;\r\n        const item = this.images[this.index];\r\n        this.imgEl.src = item.src;\r\n        this.highlightThumb();\r\n        this.resetTransform(true);\r\n        this.updateZoomIndicator();\r\n        this.updateCounter();\r\n    }\r\n\r\n    private highlightThumb() {\r\n        if (!this.thumbsEl) return;\r\n        const imgs = Array.from(this.thumbsEl.querySelectorAll('img'));\r\n        imgs.forEach((el, idx) => { el.dataset.active = String(idx === this.index); });\r\n        const active = imgs[this.index];\r\n        if (active) {\r\n            const r = active.getBoundingClientRect();\r\n            const pr = this.thumbsEl.getBoundingClientRect();\r\n            if (r.left < pr.left || r.right > pr.right) active.scrollIntoView({ inline: 'center', behavior: 'smooth', block: 'nearest' });\r\n        }\r\n    }\r\n\r\n    private updateCounter() {\r\n        const counter = this.backdrop?.querySelector('.iv-counter');\r\n        if (counter) counter.textContent = `${this.index + 1} / ${this.images.length}`;\r\n    }\r\n\r\n    private updateZoomIndicator() {\r\n        const zoomIndicator = this.backdrop?.querySelector('.iv-zoom-indicator');\r\n        if (zoomIndicator) zoomIndicator.textContent = `${Math.round(this.zoom * 100)}%`;\r\n    }\r\n\r\n    private installKeyboard() {\r\n        const handle = (e: KeyboardEvent) => {\r\n            if (!this.backdrop) return;\r\n            switch (e.key) {\r\n                case 'Escape': this.close(); break;\r\n                case 'ArrowRight': this.next(); break;\r\n                case 'ArrowLeft': this.prev(); break;\r\n                case '+': case '=': this.adjustZoom(1.25); break;\r\n                case '-': this.adjustZoom(0.8); break;\r\n                case '0': this.resetTransform(); break;\r\n            }\r\n        };\r\n        window.addEventListener('keydown', handle, { passive: true });\r\n        this.disposes.push([() => window.removeEventListener('keydown', handle), true]);\r\n    }\r\n\r\n    private installWheel(stage: HTMLElement) {\r\n        stage.addEventListener('wheel', e => {\r\n            // Direct wheel zoom (no Ctrl/⌘ required)\r\n            e.preventDefault();\r\n            // Derive scale factor from wheel delta, clamp extremes\r\n            const step = Math.max(-1, Math.min(1, e.deltaY / 100));\r\n            const factor = step < 0 ? 1 - step * 0.25 : 1 / (1 + step * 0.25); // smooth scaling\r\n            const origin = this.calculateZoomOrigin(e.clientX, e.clientY);\r\n            this.adjustZoom(factor, origin);\r\n        }, { passive: false });\r\n    }\r\n\r\n    private calculateZoomOrigin(clientX: number, clientY: number) {\r\n        const parent = this.imgEl!.parentElement;\r\n        const rect = parent!.getBoundingClientRect();\r\n        const style = window.getComputedStyle(parent!);\r\n        const paddings = { left: parseFloat(style.paddingLeft), top: parseFloat(style.paddingTop) };\r\n        const cx = clientX - rect.left - paddings.left;\r\n        const cy = clientY - rect.top - paddings.top;\r\n        return { x: cx, y: cy };\r\n    }\r\n\r\n    private installInteractions(stage: HTMLElement) {\r\n        // Mouse drag for panning\r\n        stage.addEventListener('mousedown', e => {\r\n            if (e.button !== 0) return;\r\n            this.isPanning = true;\r\n            this.panStart = { ...this.pan };\r\n            this.pointerStart = { x: e.clientX, y: e.clientY };\r\n            this.clickMoved = false;\r\n            stage.classList.add('iv-grabbing');\r\n        });\r\n        window.addEventListener('mousemove', e => {\r\n            if (!this.isPanning) return;\r\n            const dx = e.clientX - this.pointerStart.x;\r\n            const dy = e.clientY - this.pointerStart.y;\r\n            this.pan = { x: this.panStart.x + dx, y: this.panStart.y + dy };\r\n            if (Math.abs(dx) > 3 || Math.abs(dy) > 3) this.clickMoved = true;\r\n            this.applyTransform();\r\n        });\r\n        window.addEventListener('mouseup', () => {\r\n            this.isPanning = false;\r\n            stage.classList.remove('iv-grabbing');\r\n        });\r\n\r\n        // Touch: single-finger pan, two-finger pinch zoom\r\n        stage.addEventListener('touchstart', e => {\r\n            if (e.touches.length === 1) {\r\n                this.isPanning = true;\r\n                this.panStart = { ...this.pan };\r\n                this.pointerStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };\r\n                stage.classList.add('iv-grabbing');\r\n            } else if (e.touches.length === 2) {\r\n                this.isPanning = false;\r\n                this.multiTouchDist = this.distance(e.touches[0], e.touches[1]);\r\n                const midpoint = this.midpoint(e.touches[0], e.touches[1]);\r\n                this.origin = this.calculateZoomOrigin(midpoint.x, midpoint.y);\r\n                e.preventDefault();\r\n            }\r\n        }, { passive: false });\r\n        stage.addEventListener('touchmove', e => {\r\n            if (e.touches.length === 1 && this.isPanning) {\r\n                const dx = e.touches[0].clientX - this.pointerStart.x;\r\n                const dy = e.touches[0].clientY - this.pointerStart.y;\r\n                this.pan = { x: this.panStart.x + dx, y: this.panStart.y + dy };\r\n                this.applyTransform();\r\n            } else if (e.touches.length === 2) {\r\n                const dist = this.distance(e.touches[0], e.touches[1]);\r\n                const factor = dist / this.multiTouchDist;\r\n                this.adjustZoomRaw(this.zoom * factor, this.origin);\r\n                this.multiTouchDist = dist;\r\n            }\r\n        }, { passive: true });\r\n        stage.addEventListener('touchend', () => {\r\n            this.isPanning = false;\r\n            stage.classList.remove('iv-grabbing');\r\n        }, { passive: true });\r\n    }\r\n\r\n    private distance(a: Touch, b: Touch) { return Math.hypot(a.clientX - b.clientX, a.clientY - b.clientY); }\r\n\r\n    private midpoint(a: Touch, b: Touch) { return { x: (a.clientX + b.clientX) / 2, y: (a.clientY + b.clientY) / 2 }; }\r\n\r\n    private adjustZoom(factor: number, origin?: { x: number; y: number }) { this.adjustZoomRaw(this.zoom * factor, origin); }\r\n\r\n    private adjustZoomRaw(nextZoom: number, origin?: { x: number; y: number }) {\r\n        nextZoom = Math.min(this.options.maxZoom, Math.max(this.options.minZoom, nextZoom));\r\n        const prev = this.zoom;\r\n        this.zoom = nextZoom;\r\n        if (origin && this.imgEl) {\r\n            const parent = this.imgEl.parentElement!;\r\n            const pan = this.pan;\r\n            const scale = this.zoom / prev;\r\n            if (scale !== 1) {\r\n                const centerX = (parent.clientWidth * 0.5) + pan.x;\r\n                const centerY = (parent.clientHeight * 0.5) + pan.y;\r\n                const dx = origin.x - centerX;\r\n                const dy = origin.y - centerY;\r\n                const k = 1 - scale;\r\n                this.pan = { x: pan.x + dx * k, y: pan.y + dy * k };\r\n            }\r\n        }\r\n        this.applyTransform();\r\n    }\r\n\r\n    private rotate(delta: number) {\r\n        this.rotation = (this.rotation + delta);\r\n        this.applyTransform();\r\n    }\r\n\r\n    private resetTransform(resetRotation = false) {\r\n        this.zoom = 1;\r\n        this.pan = { x: 0, y: 0 };\r\n        if (resetRotation) this.rotation = 0;\r\n        this.applyTransform();\r\n    }\r\n\r\n    private applyTransform() {\r\n        if (!this.imgEl) return;\r\n        const { x, y, z, r } = { x: this.pan.x, y: this.pan.y, z: this.zoom, r: this.rotation };\r\n        this.imgEl.style.transform = `translate(${x}px, ${y}px) scale(${z}) rotate(${r}deg)`;\r\n        this.updateZoomIndicator();\r\n    }\r\n\r\n    private go(i: number) {\r\n        if (i < 0 || i >= this.images.length) return;\r\n        this.index = i;\r\n        this.render();\r\n    }\r\n\r\n    public open(startIndex = 0) {\r\n        if (!this.images.length) return;\r\n        this.index = Math.min(Math.max(0, startIndex), this.images.length - 1);\r\n        if (this.backdrop) return;\r\n\r\n        document.body.classList.add('iv-lock');\r\n        // Build from template\r\n        const wrap = document.createElement('div');\r\n        wrap.innerHTML = backdropTemplate.trim();\r\n        const backdrop = wrap.firstElementChild as HTMLElement | null;\r\n        if (!backdrop) return;\r\n        if (this.options.className) backdrop.classList.add(...this.options.className.split(/\\s+/).filter(Boolean));\r\n        const stage = backdrop.querySelector<HTMLElement>('.iv-stage');\r\n        const imgEl = backdrop.querySelector<HTMLImageElement>('.iv-stage img');\r\n        let thumbs = backdrop.querySelector<HTMLElement>('.iv-thumbs');\r\n        if (!stage || !imgEl) return;\r\n        // thumbnails handling\r\n        if (this.options.thumbnails) {\r\n            if (thumbs) {\r\n                thumbs.replaceChildren();\r\n                this.images.forEach((it, i) => {\r\n                    const t = this.#createEl('img', { src: it.src, alt: it.alt || '', loading: 'lazy' });\r\n                    t.addEventListener('click', () => this.go(i));\r\n                    thumbs.appendChild(t);\r\n                });\r\n                this.thumbsEl = thumbs;\r\n            }\r\n        } else {\r\n            thumbs?.remove();\r\n            this.thumbsEl = undefined;\r\n        }\r\n        // backdrop close\r\n        if (this.options.closeOnBackdrop) {\r\n            backdrop.addEventListener('mousedown', e => { if (e.target === backdrop) this.close(); });\r\n        }\r\n        // stage blank click close\r\n        stage.addEventListener('click', e => { if (!this.clickMoved) this.close(); });\r\n        // delegate buttons\r\n        backdrop.querySelectorAll<HTMLElement>('[data-action]').forEach(btn => {\r\n            btn.addEventListener('click', e => {\r\n                e.stopPropagation();\r\n                switch (btn.dataset.action) {\r\n                    case 'prev': this.prev(); break;\r\n                    case 'next': this.next(); break;\r\n                    case 'zoom-in': this.adjustZoom(1.25); break;\r\n                    case 'zoom-out': this.adjustZoom(0.8); break;\r\n                    case 'rotate-left': this.rotate(-90); break;\r\n                    case 'rotate-right': this.rotate(90); break;\r\n                    case 'reset': this.resetTransform(true); break;\r\n                }\r\n            });\r\n        });\r\n        document.body.appendChild(backdrop);\r\n        requestAnimationFrame(() => backdrop.classList.add('iv-active'));\r\n        this.backdrop = backdrop;\r\n        this.imgEl = imgEl;\r\n\r\n        this.installInteractions(stage);\r\n        if (this.options.keyboard) this.installKeyboard();\r\n        if (this.options.wheelZoom) this.installWheel(stage);\r\n        this.render();\r\n        this.options.onOpen?.();\r\n    }\r\n\r\n    public next() { this.go(this.index + 1); }\r\n\r\n    public prev() { this.go(this.index - 1); }\r\n\r\n    public close() {\r\n        if (!this.backdrop) return;\r\n        // Play closing animation\r\n        const bd = this.backdrop;\r\n        bd.classList.remove('iv-active');\r\n        bd.classList.add('iv-leave');\r\n        const done = () => {\r\n            bd.removeEventListener('transitionend', done);\r\n            bd.remove();\r\n            this.backdrop = undefined;\r\n            this.imgEl = undefined;\r\n            document.body.classList.remove('iv-lock');\r\n            this.options.onClose?.();\r\n        };\r\n        bd.addEventListener('transitionend', done);\r\n        this.disposes.forEach(item => item[1] && item[0]());\r\n    }\r\n\r\n    public destroy() {\r\n        this.close();\r\n        // Clean up event listeners\r\n        this.disposes.forEach(item => item[0]());\r\n        this.disposes = [];\r\n    }\r\n}\r\n\r\n// Factory function\r\nexport function createImageViewer(options?: ViewerOptions) { return new ImageViewer(options); }\r\n"]}